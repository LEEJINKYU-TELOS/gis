# GIS 타일맵 뷰어 기능정의서

**작성자**: 이진규
**작성일**: 2025-11-04
**버전**: 1.0

---

## 1. 프로젝트 개요

### 1.1 목적
커스텀 타일맵 서버를 기반으로 한 웹 GIS 뷰어 개발

### 1.2 주요 기능
- 타일맵 표출 (래스터 타일)
- 마커 표시 및 관리 (수천 개 규모)
- 마커 클릭 시 상세정보 표시 (모달/패널)
- 도로 네트워크 표시 (대용량 GeoJSON, 280MB+)

### 1.3 타겟 사용자
내부 관리자 및 분석가

---

## 2. 기술 스택

### 2.1 프론트엔드
- **프레임워크**: Next.js 14+ (App Router)
- **지도 라이브러리**: OpenLayers 9.x
- **언어**: TypeScript
- **스타일링**: Tailwind CSS
- **상태관리**: Zustand
- **UI 컴포넌트**: Shadcn/ui 또는 Radix UI

### 2.2 백엔드 (기존)
- **타일맵 서버**: http://192.168.0.140:8082
- **타일 형식**: PNG (XYZ 타일)
- **좌표계**: 미정 (확인 필요)

### 2.3 데이터
- **배경지도**: 래스터 타일 (PNG)
- **마커**: GeoJSON (수천 개)
- **도로 네트워크**: GeoJSON (280MB+) → 벡터 타일로 전환 예정

---

## 3. 상세 기능 요구사항

### 3.1 Phase 1: 기본 타일맵 표출 (우선순위: 높음)

#### 3.1.1 지도 초기화
- OpenLayers 지도 컨테이너 생성
- 기본 뷰 설정 (중심 좌표, 줌 레벨)
- 최소/최대 줌 레벨 제한

#### 3.1.2 래스터 타일 레이어
- 타일 소스: `http://192.168.0.140:8082/tiles/SD/L{level}/{x}/{y}.png`
- XYZ 타일 형식 지원
- 타일 로딩 에러 처리
- 로딩 인디케이터 표시

#### 3.1.3 기본 인터랙션
- 지도 팬 (드래그)
- 줌 인/아웃 (마우스 휠, 버튼)
- 더블클릭 줌

#### 3.1.4 성능 요구사항
- 초기 로딩 시간: 2초 이내
- 타일 전환 시 부드러운 애니메이션
- 메모리 누수 방지

---

### 3.2 Phase 2: 마커 레이어 (우선순위: 높음)

#### 3.2.1 마커 표시
- GeoJSON 형식 마커 데이터 로드
- 마커 수: 수천 개 (1,000 ~ 10,000개)
- 마커 스타일 커스터마이징
  - 기본 마커 아이콘
  - 선택된 마커 하이라이트
  - 마커 크기 조정

#### 3.2.2 마커 클러스터링
- 줌 레벨에 따른 자동 클러스터링
- 클러스터 내 마커 개수 표시
- 클러스터 클릭 시 확대

#### 3.2.3 마커 인터랙션
- 마커 클릭 이벤트
- 마커 호버 효과
- 마커 선택 상태 관리

#### 3.2.4 성능 요구사항
- 5,000개 마커 렌더링 시 60fps 유지
- 클러스터링 적용으로 체감 성능 최적화

---

### 3.3 Phase 3: 정보 표시 UI (우선순위: 중간)

#### 3.3.1 마커 상세정보 모달
- 마커 클릭 시 모달 표시
- 모달 내용:
  - 마커 제목
  - 좌표 정보
  - 추가 속성 정보
  - 닫기 버튼

#### 3.3.2 정보 패널 (대안)
- 화면 우측 또는 하단 패널
- 패널 열기/닫기 토글
- 패널 크기 조정 가능

#### 3.3.3 UI/UX
- 반응형 디자인 (모바일 지원 여부는 추후 결정)
- 접근성 (키보드 네비게이션)
- 다크모드 지원 (선택사항)

---

### 3.4 Phase 4: 도로 네트워크 레이어 (우선순위: 낮음)

#### 3.4.1 데이터 준비
- 280MB GeoJSON → 벡터 타일 전환
- 도구: Tippecanoe
- 출력: MBTiles 또는 PMTiles

#### 3.4.2 벡터 타일 서버
- TileServer GL 구축
- 타일 서빙 엔드포인트: `/tiles/{z}/{x}/{y}.pbf`

#### 3.4.3 도로 레이어 표시
- OpenLayers VectorTile 소스 사용
- 스타일링:
  - 도로 등급별 색상
  - 줌 레벨별 선 두께
  - 라벨 표시 (선택사항)

#### 3.4.4 성능 요구사항
- 벡터 타일 캐싱
- WebGL 렌더링 활용

---

### 3.5 Phase 5: 추가 기능 (우선순위: 낮음)

#### 3.5.1 레이어 컨트롤
- 레이어 켜기/끄기 토글
- 레이어 투명도 조절
- 레이어 순서 변경

#### 3.5.2 검색 기능
- 마커 검색 (이름, 속성)
- 검색 결과 하이라이트
- 검색 결과로 지도 이동

#### 3.5.3 측정 도구
- 거리 측정
- 면적 측정
- 측정값 표시

---

## 4. 데이터 명세

### 4.1 타일맵 서버

#### 타일 URL 형식
```
http://192.168.0.140:8082/tiles/SD/L{level}/{x}/{y}.png
```

**파라미터:**
- `{level}`: 줌 레벨 (예: 0-18)
- `{x}`: 타일 X 좌표
- `{y}`: 타일 Y 좌표

**확인 필요 사항:**
- 지원하는 줌 레벨 범위
- 좌표계 (EPSG:3857 또는 EPSG:4326)
- 초기 뷰 중심 좌표
- 타일 크기 (256x256 또는 512x512)

### 4.2 마커 데이터 (GeoJSON)

#### 예상 구조
```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [경도, 위도]
      },
      "properties": {
        "id": "마커 고유 ID",
        "name": "마커 이름",
        "description": "설명",
        "category": "카테고리"
      }
    }
  ]
}
```

**확인 필요 사항:**
- 정확한 속성 필드
- 데이터 소스 (API 엔드포인트 또는 정적 파일)
- 업데이트 주기

### 4.3 도로 네트워크 데이터

**현재:**
- 형식: GeoJSON
- 크기: 280MB+
- 지오메트리 타입: LineString

**변환 후:**
- 형식: 벡터 타일 (MVT)
- 서빙 방식: TileServer GL

---

## 5. 비기능 요구사항

### 5.1 성능
- 초기 로딩: 2초 이내
- 타일 로딩: 500ms 이내
- 프레임 레이트: 60fps 유지

### 5.2 호환성
- 브라우저: Chrome, Firefox, Safari, Edge (최신 2개 버전)
- 해상도: 1920x1080 최적화

### 5.3 보안
- CORS 설정 확인
- XSS 방어
- 민감 정보 노출 방지

### 5.4 유지보수성
- TypeScript 타입 정의
- 컴포넌트 단위 분리
- 주석 및 문서화

---

## 6. 개발 일정 (예상)

| Phase | 기능 | 예상 소요 시간 |
|-------|------|--------------|
| Phase 1 | 기본 타일맵 표출 | 1-2일 |
| Phase 2 | 마커 레이어 | 2-3일 |
| Phase 3 | 정보 표시 UI | 2일 |
| Phase 4 | 도로 네트워크 레이어 | 3-5일 |
| Phase 5 | 추가 기능 | 협의 후 결정 |

---

## 7. 위험 요소 및 대응 방안

### 7.1 대용량 도로 네트워크 데이터
**위험**: 280MB GeoJSON 로딩 시 브라우저 프리징
**대응**: 벡터 타일 전환 필수, bbox 필터링 API 개발

### 7.2 타일맵 서버 안정성
**위험**: 타일 서버 다운 시 지도 표시 불가
**대응**: 에러 처리, 대체 타일 소스 준비

### 7.3 마커 성능
**위험**: 수천 개 마커로 인한 성능 저하
**대응**: 클러스터링 적용, Canvas 렌더링 사용

---

## 8. 참고 자료

### 8.1 OpenLayers
- 공식 문서: https://openlayers.org/
- 예제: https://openlayers.org/en/latest/examples/

### 8.2 벡터 타일 변환
- Tippecanoe: https://github.com/felt/tippecanoe
- TileServer GL: https://github.com/maptiler/tileserver-gl

### 8.3 Next.js + OpenLayers
- 커뮤니티 예제 및 블로그 참고

---

## 9. 다음 단계

1. **타일맵 서버 정보 확인**
   - 줌 레벨 범위
   - 좌표계
   - 초기 뷰 설정값

2. **마커 데이터 샘플 확보**
   - GeoJSON 샘플 파일 또는 API 엔드포인트

3. **Phase 1 개발 시작**
   - Next.js 프로젝트 생성
   - OpenLayers 통합
   - 기본 타일맵 표출

4. **개발 환경 설정**
   - TypeScript 설정
   - ESLint/Prettier
   - Git 저장소 초기화
